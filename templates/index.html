<!DOCTYPE html>
<html>
<head>
    <title>Kenya Investment Comparator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Kenya Investment Comparator ðŸ”¥</h1>
    <form method="POST">
        <label>Amount to Invest (KES):</label>
        <input type="number" name="amount" required placeholder="100,000">

        <label>Investment Horizon (Years):</label>
        <input type="number" step="0.1" name="horizon" required placeholder="1, 2, 5, etc.">

        <label>Risk Preference:</label>
        <select name="risk">
            <option>All</option>
            <option>Very Low</option>
            <option>Low</option>
            <option>Medium</option>
            <option>Medium-High</option>
            <option>High</option>
            <option>Very High</option>
        </select>

        <button type="submit">Compare Options</button>
    </form>

    {% if results %}
        <form method="POST" action="/export">
            <input type="hidden" name="amount" value="{{ amount }}">
            <input type="hidden" name="horizon" value="{{ horizon }}">
            <input type="hidden" name="risk" value="{{ request.form.get('risk','All') }}">
            <button type="submit" class="export-btn">Export CSV</button>
        </form>

        <table>
            <tr>
                <th>Asset</th>
                <th>Category</th>
                <th>Gross Return (KES)</th>
                <th>Net Return (KES)</th>
                <th>Risk</th>
                <th>Liquidity</th>
                <th>Liquidity Warning</th>
                <th>Description</th>
            </tr>
            {% for r in results %}
            <tr>
                <td>{{ r.name }}</td>
                <td>{{ r.category }}</td>
                <td>{{ r.gross_return }}</td>
                <td>{{ r.net_return }}</td>
                <td class="{{ r.risk.replace(' ', '-') }}">{{ r.risk }}</td>
                <td>{{ r.liquidity }}</td>
                <td class="liquidity-warning">{{ r.liquidity_warning }}</td>
                <td>{{ r.description }}</td>
            </tr>
            {% endfor %}
        </table>

        <!-- Bar chart -->
        <h2 style="margin-top: 30px;">Projected Net Returns</h2>
        <canvas id="returnChart" style="max-width:100%;height:300px;"></canvas>

        <script>
            const ctx = document.getElementById('returnChart').getContext('2d');
            const labels = [{% for r in results %}'{{ r.name }}',{% endfor %}];
            const data = [{% for r in results %}{{ r.net_return }},{% endfor %}];
            const backgroundColors = [{% for r in results %}
                {% if r.risk == 'Very Low' %}'#2ecc71'{% elif r.risk == 'Low' %}'#27ae60'
                {% elif r.risk == 'Medium' or r.risk == 'Medium-High' %}'#e67e22'
                {% elif r.risk == 'High' or r.risk == 'Very High' %}'#e74c3c'
                {% else %}'#3498db'{% endif %},
            {% endfor %}];

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Projected Net Return (KES)',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: '#34495e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'KES' }
                        },
                        x: {
                            title: { display: true, text: 'Assets' }
                        }
                    }
                }
            });
        </script>
    {% endif %}
</body>
</html>
